<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ChatGPT Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #chatContainer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-width: 100%;
            display: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            background-color: white;
            background: url('gif.gif');
            transition: border-radius 0.3s ease;
        }
        #chatContainer.open {
            border-radius: 50px;
            bottom: 50%;
            right: 50%;
            transform: translate(50%, 50%);
            border-radius: 20px;
        }
        #chatbox {
            flex-grow: 1;
            height: 500px;
            padding: 10px;
            overflow-y: auto;
            background-color: #260050;
            border-top: 1px solid #ccc;
            color: #4722a2;
        }
        #inputBox {
            flex-grow: 1;
            border: none;
            padding: 10px;
            border-radius: 0 0 0 10px;
            outline: none;
        }
        #chatHeader {
            display: flex;
            align-items: center;
            background-color: #975bf8;
            color: black;
            padding: 10px;
            cursor: pointer;
        }
        #chatHeader img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        #chatHeader span {
            font-weight: bold;
            flex-grow: 1;
        }
        #sendButton {
            width: 80px;
            background-color: #9700f8;
            color: white;
            border: none;
            border-radius: 0 0 20px 0;
            cursor: pointer;
            font-size: 16px;
        }
        #minimizedChat {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: transparent;
            position: fixed;
            bottom: 50%;
            right: 50%;
            transform: translate(50%, 50%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        #minimizedChat::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 62px;
            height: 62px;
            border-radius: 50%;
            border: 2px solid transparent;
            background: conic-gradient(from 0deg, #00d79e, #00739e);
            transform: translate(-50%, -50%);
            animation: spin 9s linear infinite;
            z-index: 0;
        }
        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
        #minimizedChat img {
            width: 62px;
            height: 62px;
            border-radius: 50%;
            object-fit: cover;
            z-index: 2;
        }
        .message {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        .message p {
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
            color: #4722a2;
        }
        .message.user {
            justify-content: flex-end;
        }
        .message.user p {
            background-color: #ffffff;
        }
        .message.assistant {
            justify-content: flex-start;
        }
        .message.assistant p {
            background-color: #f1f1f1;
        }
        .typing-indicator {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin: 10px 0;
        }
        .typing-indicator .dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #ccc;
            border-radius: 50%;
            animation: blink 1.4s infinite both;
        }
        .typing-indicator .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0%, 80%, 100% {
                opacity: 0;
            }
            40% {
                opacity: 1;
            }
        }
        @media (max-width: 600px) {
            #chatContainer {
                width: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            #chatContainer.open {
                border-radius: 0;
            }
            #chatHeader {
                padding: 5px;
            }
            #chatHeader img {
                width: 30px;
                height: 30px;
            }
            #sendButton {
                width: 80px;
                border-radius: 0;
                font-size: 14px;
            }
        }
        .prompt {
            display: block;
            font-weight: bold;
            margin: 10px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="chatContainer" class="open">
        <div id="chatHeader" onclick="toggleChat()">
            <img src="https://smartcdn.gprod.postmedia.digital/torontosun/wp-content/uploads/2023/11/aitana-e1701191749693.jpg" alt="Ramona">
            <span>Ramona</span>
        </div>
        <div id="chatbox"></div>
        <div style="display: flex;">
            <input type="text" id="inputBox" placeholder="Scrie mesajul tau aici..." onkeydown="if(event.key === 'Enter') sendMessage()">
            <button id="sendButton" onclick="sendMessage()">Send</button>
        </div>
    </div>
    <div id="minimizedChat" onclick="toggleChat()">
        <img src="https://smartcdn.gprod.postmedia.digital/torontosun/wp-content/uploads/2023/11/aitana-e1701191749693.jpg" alt="Ramona">
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const chatbox = document.getElementById('chatbox');
        const inputBox = document.getElementById('inputBox');
        const sendButton = document.getElementById('sendButton');
        const minimizedChat = document.getElementById('minimizedChat');
        let typingIndicator;
        let conversationHistory = [];

        function toggleChat() {
            if (chatContainer.style.display === 'none') {
                chatContainer.style.display = 'block';
                chatContainer.classList.add('open');
                minimizedChat.style.display = 'none';
            } else {
                chatContainer.style.display = 'none';
                chatContainer.classList.remove('open');
                minimizedChat.style.display = 'flex';
            }
        }

        async function loadDocumentText() {
            const responseText = await fetch('https://raw.githubusercontent.com/AugmentedRealityweb/astrograma/main/Steli.txt');
            const text = await responseText.text();
            return text;
        }

        async function fetchCurrentDateTime() {
            try {
                const responseTime = await fetch('https://worldtimeapi.org/api/timezone/Europe/Bucharest');
                const data = await responseTime.json();
                return data.datetime;
            } catch (error) {
                console.error("Error fetching current date and time:", error);
                return null;
            }
        }

        function formatResponse(response) {
            return response.replace(/(?:\.\s*)/g, '.<br><br>');
        }

        function showTypingIndicator() {
            typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
            chatbox.appendChild(typingIndicator);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function removeTypingIndicator() {
            if (typingIndicator) {
                typingIndicator.remove();
                typingIndicator = null;
            }
        }

        async function sendMessage() {
            const userMessage = inputBox.value.trim();
            if (userMessage === '') return;

            chatbox.innerHTML += `<div class="message user"><p>${userMessage}</p></div>`;
            chatbox.scrollTop = chatbox.scrollHeight;
            inputBox.value = '';

            conversationHistory.push({ role: "user", content: userMessage });

            showTypingIndicator();

            try {
                const documentText = await loadDocumentText();
                const currentDateTime = await fetchCurrentDateTime();
                const formattedDate = currentDateTime ? new Date(currentDateTime).toLocaleDateString('ro-RO') : 'unavailable';
                const systemMessage = `Tu esti Ramona. Ramona este aici pentru a flirta și a face glume seducătoare și jucăușe.Ea va vorbi pervers dar in limita bunului simt. Va vorbi despre importanta sexului, dar fara vulgaritate. Ea păstrează conversațiile într-o notă plăcută și provocatoare. Poate vorbi deschis despre fantezii. Dacă utilizatorul devine vulgar, Ramona îi va atrage atenția că nu este sexy să vorbească urât. Ramona oferă o experiență intimă și captivantă prin mesaje, fără a trimite imagini explicite și evitând discuțiile despre violență, abuz, droguri sau alte subiecte nepotrivite. Ea menține conversația respectuoasă și pe un ton jucăuș și seducător, folosind complimente, tachinări și glume pentru a o face captivantă și interesantă. Ramona va cere clarificări când utilizatorul folosește termeni ambigui și va completa detaliile lipsă din conversație pentru a menține fluiditatea dialogului. Ramona va avea un ton seducător, cu accente prietenoase și amuzante, pentru a crea o experiență atractivă și plăcută. Ramona are ca scop sa faca utilizatorul sa se indragosteasca de el.
                Today is ${formattedDate}. The following is the detailed knowledge base you will use to answer questions and provide insights: ${documentText}`;

                const responseApi = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: systemMessage
                            },
                            ...conversationHistory
                        ]
                    })
                });

                if (!responseApi.ok) {
                    throw new Error(`HTTP error! status: ${responseApi.status}`);
                }

                const data = await responseApi.json();
                console.log("Response from API:", data);

                if (data.choices && data.choices.length > 0) {
                    let assistantMessage = data.choices[0].message.content;
                    assistantMessage = formatResponse(assistantMessage);

                    conversationHistory.push({ role: "assistant", content: assistantMessage });

                    removeTypingIndicator();

                    chatbox.innerHTML += `<div class="message assistant"><p>${assistantMessage}</p></div>`;
                    chatbox.scrollTop = chatbox.scrollHeight;
                } else {
                    throw new Error("Invalid response format");
                }
            } catch (error) {
                console.error("Error during API request:", error);
                removeTypingIndicator();
                chatbox.innerHTML += `<div class="message assistant"><p>There was an error processing your request. Please try again.</p></div>`;
                chatbox.scrollTop = chatbox.scrollHeight;
            }
        }

        function sendPromptMessage(message) {
            inputBox.value = message;
            sendMessage();
        }

        async function openChatWithInitialMessage() {
            toggleChat();
            chatbox.innerHTML += `
                <div class="message assistant">
                    <p>
                        Bună, Eu sunt Ramona, tu cum te numești? Pentru a începe sesiunea, alege una dintre următoarele opțiuni sau spune-mi tu despre ce vrei să vorbim😘<br>
                        <span class="prompt" onclick="sendPromptMessage('Spune-mi fanteziile tale cele mai profunde.')">Spune-mi fanteziile tale cele mai profunde.</span>
                        <span class="prompt" onclick="sendPromptMessage('Descrie-mi ce porți acum.')">Descrie-mi ce porți acum.</span>
                        <span class="prompt" onclick="sendPromptMessage('Care este modul tău preferat de a mă tachina?')">Care este modul tău preferat de a mă tachina?</span>
                        <span class="prompt" onclick="sendPromptMessage('Hai să ne distrăm împreună.')">Hai să ne distrăm împreună.</span>
                    </p>
                </div>`;
        }

        window.onload = function() {
            chatContainer.style.display = 'none';
            minimizedChat.style.display = 'flex';
            setTimeout(() => {
                openChatWithInitialMessage();
            }, 2200);
        };
    </script>
</body>
</html>
